{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/yoges/Downloads/saaf-dilli-project-new/src/services/aqi-service.ts"],"sourcesContent":["'use server';\r\nimport type { AQIData, MapAqiData } from '@/lib/types';\r\nimport { WAQI_API_TOKEN, DELHI_AQI_STATIONS } from '@/lib/constants';\r\n\r\nconst API_BASE_URL = 'https://api.waqi.info';\r\n\r\nexport async function getAqiForStation(stationUid: number): Promise<AQIData | null> {\r\n  try {\r\n    const response = await fetch(`${API_BASE_URL}/feed/@${stationUid}/?token=${WAQI_API_TOKEN}`, { next: { revalidate: 60 } });\r\n    if (!response.ok) {\r\n      console.error(`Failed to fetch AQI data for station ${stationUid}: ${response.statusText}`);\r\n      return null;\r\n    }\r\n\r\n    const json = await response.json();\r\n\r\n    if (json.status !== 'ok') {\r\n      console.error(`API error for station ${stationUid}: ${json.data}`);\r\n      return null;\r\n    }\r\n\r\n    const data: AQIData = json.data;\r\n    return data;\r\n  } catch (error) {\r\n    console.error(`Error fetching AQI data for station ${stationUid}:`, error);\r\n    return null;\r\n  }\r\n}\r\n\r\nexport async function getAqiForMapBounds(): Promise<MapAqiData[] | null> {\r\n  try {\r\n    const latlng = '28.4042,76.8370,28.8835,77.3336';\r\n    const response = await fetch(`${API_BASE_URL}/map/bounds/?latlng=${latlng}&token=${WAQI_API_TOKEN}`, { next: { revalidate: 60 } });\r\n    \r\n    if (!response.ok) {\r\n      console.error(`Failed to fetch map bounds AQI data: ${response.statusText}`);\r\n      return null;\r\n    }\r\n\r\n    const json = await response.json();\r\n\r\n    if (json.status !== 'ok') {\r\n      console.error(`API error for map bounds: ${json.data}`);\r\n      return null;\r\n    }\r\n\r\n    const data: MapAqiData[] = json.data;\r\n    return data;\r\n\r\n  } catch (error) {\r\n    console.error('Error fetching map bounds AQI data:', error);\r\n    return null;\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;IA6BsB,qBAAA,WAAA,GAAA,CAAA,GAAA,yNAAA,CAAA,wBAAA,EAAA,8CAAA,yNAAA,CAAA,aAAA,EAAA,KAAA,GAAA,yNAAA,CAAA,mBAAA,EAAA","debugId":null}},
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/yoges/Downloads/saaf-dilli-project-new/src/app/%28main%29/dashboard/_components/live-aqi-map.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';\r\nimport { Map } from 'lucide-react';\r\nimport 'leaflet/dist/leaflet.css';\r\nimport { getAqiInfo } from '@/app/(main)/dashboard/citizen/_components/aqi-badge';\r\nimport { useEffect, useState, useRef } from 'react';\r\nimport { getAqiForMapBounds } from '@/services/aqi-service';\r\nimport type { MapAqiData } from '@/lib/types';\r\nimport L from 'leaflet';\r\nimport { Skeleton } from '@/components/ui/skeleton';\r\n\r\n// Fix for default icon not showing in Next.js\r\nif (typeof window !== 'undefined') {\r\n    delete (L.Icon.Default.prototype as any)._getIconUrl;\r\n    L.Icon.Default.mergeOptions({\r\n      iconRetinaUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png',\r\n      iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',\r\n      shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',\r\n    });\r\n}\r\n\r\nconst LiveAqiMap = () => {\r\n    const mapRef = useRef<L.Map | null>(null);\r\n    const mapContainerRef = useRef<HTMLDivElement>(null);\r\n    const [stationData, setStationData] = useState<MapAqiData[]>([]);\r\n    const [mapReady, setMapReady] = useState(false);\r\n    \r\n    useEffect(() => {\r\n        const fetchMapData = async () => {\r\n            const data = await getAqiForMapBounds();\r\n            if (data) {\r\n                setStationData(data);\r\n            }\r\n        };\r\n        fetchMapData();\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (mapContainerRef.current && !mapRef.current) {\r\n            mapRef.current = L.map(mapContainerRef.current, { zoomControl: false }).setView([28.6139, 77.2090], 10);\r\n            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {\r\n                attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors &copy; <a href=\"https://carto.com/attributions\">CARTO</a>',\r\n                subdomains: 'abcd',\r\n                maxZoom: 20\r\n            }).addTo(mapRef.current);\r\n            L.control.zoom({ position: 'topright' }).addTo(mapRef.current);\r\n            setMapReady(true);\r\n        }\r\n\r\n        return () => {\r\n            if (mapRef.current) {\r\n                mapRef.current.remove();\r\n                mapRef.current = null;\r\n            }\r\n        };\r\n    }, []); \r\n\r\n    useEffect(() => {\r\n        if (mapReady && mapRef.current && stationData.length > 0) {\r\n            mapRef.current.eachLayer((layer) => {\r\n                if (layer instanceof L.Marker) {\r\n                    mapRef.current?.removeLayer(layer);\r\n                }\r\n            });\r\n\r\n            stationData.forEach(data => {\r\n                if (isNaN(Number(data.aqi))) return;\r\n\r\n                const { color } = getAqiInfo(Number(data.aqi));\r\n                const aqiValue = Number(data.aqi);\r\n                const size = aqiValue > 200 ? 40 : aqiValue > 100 ? 35 : 30;\r\n\r\n                const icon = L.divIcon({\r\n                    html: `<div class=\"aqi-marker-pin\" style=\"background-color: ${color.replace('bg-','').replace('-500','').replace('-600','').replace('-900','')}; width: ${size}px; height: ${size}px;\">${data.aqi}</div>`,\r\n                    className: 'aqi-marker',\r\n                    iconSize: [size, size],\r\n                    iconAnchor: [size/2, size/2]\r\n                });\r\n                \r\n                L.marker([data.lat, data.lon], { icon })\r\n                .addTo(mapRef.current as L.Map)\r\n                .bindPopup(`\r\n                    <div class=\"font-sans p-1\">\r\n                        <h3 class=\"font-bold text-base mb-1\">${data.station.name}</h3>\r\n                        <p class=\"text-sm\">Live AQI: <span class=\"font-bold text-lg\">${data.aqi}</span></p>\r\n                        <p class=\"text-xs text-muted-foreground mt-2\">Last updated: ${new Date(data.station.time).toLocaleString()}</p>\r\n                    </div>\r\n                `, {\r\n                    closeButton: false,\r\n                    className: 'aqi-popup'\r\n                });\r\n            });\r\n        }\r\n    }, [stationData, mapReady]);\r\n\r\n  return (\r\n    <Card className=\"glassmorphic-card h-[500px] p-6 shadow-lg flex flex-col\">\r\n      <h2 className=\"text-3xl font-bold tracking-tight text-white\">Live AQI Map</h2>\r\n      <p className=\"mt-2 text-white/70 mb-4\">Explore a dynamic, adaptive atmospheric map of Delhi.</p>\r\n      <div className=\"flex-grow w-full rounded-lg relative overflow-hidden group\">\r\n        <div className=\"h-full w-full rounded-lg overflow-hidden z-0 border border-primary/20\" ref={mapContainerRef}>\r\n            {!mapReady && <Skeleton className=\"h-full w-full\" />}\r\n        </div>\r\n      </div>\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default LiveAqiMap;\r\n"],"names":[],"mappings":"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","debugId":null}}]
}